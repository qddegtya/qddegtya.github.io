---
layout: singlepost
title: llpage - ğŸš€ page operation model (in memory) with LRU & lifecycle strategy.
tags: javascript llpage
category: work
---

> ğŸš€ page operation model (in memory) with LRU & lifecycle strategy.

![model](https://user-images.githubusercontent.com/773248/52936637-b8803900-3397-11e9-834f-f5bb76776663.png) 

<!-- more -->

# Motivation

å¤§å‹å‰ç«¯å¾®åº”ç”¨æ¶æ„ä¸­ï¼Œå¾€å¾€éœ€è¦ `åœ¨æŸä¸ªç‰¹å®šå®¹å™¨ DOM èŠ‚ç‚¹é‡Œé¢‘ç¹æ“ä½œå„ç§ä¸šåŠ¡å…¥å£é¡µé¢`ã€‚æ— è®ºæ˜¯å¦ä½¿ç”¨ `æ¸è¿›å¢å¼ºç­–ç•¥` æ¥å®Œå–„å’Œä¼˜åŒ–ç”¨æˆ·ä½“éªŒï¼ˆæ¯”å¦‚æ˜¯å¦å¯ç”¨ `iframe`ï¼Œäº¦æˆ–æ˜¯è¿›åŒ–åˆ°æŸç§ `å‰ç«¯å¾®åº”ç”¨æ¶æ„`ï¼‰ï¼Œæˆ‘ä»¬éƒ½å¸Œæœ›è¿™äº›é¡µé¢åœ¨è¿è¡Œæ—¶ä¹‹ä¸‹èƒ½å¤Ÿåšåˆ°ï¼š

* çµæ´»æ„ŸçŸ¥é¡µé¢ç”Ÿå‘½å‘¨æœŸï¼Œä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Ÿå¥½å¤„æ˜¾è€Œæ˜“è§ï¼Œè¿™ä¸ªè¯‰æ±‚çš„åœºæ™¯ä¹Ÿå¯ä»¥ä¸¾å‡ºå¾ˆå¤šã€‚æ¯”å¦‚å½“é¡µé¢ä¸å¯è§æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å»ºè®®å¼€å‘è€…åœæ­¢é¡µé¢ä¸­å¤§é‡è€—æ—¶çš„è½®è¯¢ä»»åŠ¡ã€åœ¨é¡µé¢è¿›å…¥é€€å‡ºçš„æ—¶å€™è¿›è¡Œç”¨æˆ·è¡Œä¸ºè¿½è¸ªã€åˆ¶ä½œè½¬åœºåŠ¨ç”»ç­‰ã€‚å½“æˆ‘ä»¬çš„é¡µé¢è¿è¡Œåœ¨æµè§ˆå™¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸€äº›ç°æœ‰çš„èƒ½åŠ›æ¥æ”¯æ’‘ï¼Œå¦‚æœä½ å¯¹æ­¤æ„Ÿå…´è¶£ï¼ŒWICG æœ‰ä¸€é¡¹æ­£åœ¨è¿›è¡Œä¸­çš„ spec [Lifecycle API for Web Pages](https://github.com/WICG/page-lifecycle) ä¹Ÿé˜è¿°äº†è¿™æ ·çš„ä¸€ä¸ªè§‚ç‚¹ï¼Œ**ä½†æ˜¯å½“æˆ‘ä»¬çš„é¡µé¢è·‘åœ¨ç‰¹å®šçš„è‡ªè¡Œç ”å‘çš„å®¹å™¨æ—¶ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦ä¸€ä¸ªéå¸¸ç±»ä¼¼çš„å†…å­˜æ“ä½œæ¨¡å‹**ï¼Œæœ¬è´¨ä¸Šæ˜¯é€šè¿‡å¯¹å®¹å™¨å†…é¡µé¢æ¤å…¥ç”Ÿå‘½å‘¨æœŸï¼Œæ¥è®©é¡µé¢é’ˆå¯¹ç”Ÿå‘½å‘¨æœŸèŠ‚ç‚¹ï¼ŒåŠæ—¶å¯¹`èµ„æº`è¿›è¡Œä¸€äº›å›æ”¶ï¼Œè¾¾åˆ°è®©å®¹å™¨æ›´åŠ ç¨³å®šçš„ç›®çš„
* é¡µé¢ç®¡ç†å®¹å™¨å¯ä»¥çµæ´»è®¾ç½®æœ€å¤§é¡µé¢ä¿æ´» (keep alive) æ•°é‡ï¼Œ**æˆ‘ä»¬ä¸åº”è¯¥è®©ä¸šåŠ¡é¡µé¢å…¥å£å¯¹åº”çš„æŒ‚è½½ç‚¹æ— é™åˆ¶åœ°å¢é•¿**ï¼Œè€Œåº”è¯¥æ ¹æ®è¿è¡Œæ—¶çš„èµ„æºæƒ…å†µï¼Œå¦¥å–„åˆ†é…è¿™ä¸ªå€¼
* `å‘å¾®åº”ç”¨æ¶æ„é›†æˆã€è¿ˆè¿›`ï¼Œ2016 å¹´åº•ï¼Œ[Thoughtworks](https://www.thoughtworks.com/cn/radar) åœ¨æŠ€æœ¯é›·è¾¾ä¸Šé¦–æ¬¡æåŠ`å‰ç«¯å¾®åº”ç”¨`çš„æ¶æ„ç†å¿µï¼Œå°†å¤§å‹å‰ç«¯åº”ç”¨çš„`åˆ†æ²»`è¯‰æ±‚è·ŸæœåŠ¡ç«¯å¸¸è§çš„`å¾®æœåŠ¡`æ€æƒ³ç»“åˆåœ¨ä¸€èµ·ã€‚è§£å†³äº†å¤§å‹å‰ç«¯åº”ç”¨å¤šäººååŒçš„å·¥ç¨‹æ•ˆèƒ½é—®é¢˜ï¼Œä¹Ÿä¸º`micro-frontends`æä¾›äº†ä¸€ç§å¯è¡Œçš„[æ¶æ„æ€è·¯](https://micro-frontends.org/)ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä¸ºäº†è®©å¾®åº”ç”¨æ¶æ„è·‘çš„æ›´å¥½ã€æ›´å¿«ã€æ›´ç¨³å®šï¼Œå¾€å¾€éœ€è¦å®šåˆ¶ä¸€ä¸ªå¥å£®çš„`è¿è¡Œæ—¶å®¹å™¨`ï¼Œåœ¨å®¹å™¨ä¹‹ä¸Šé•¿å‡ºå¾®åº”ç”¨æ¶æ„ï¼Œå®ƒå¯èƒ½é•¿ä¸‹å›¾è¿™æ ·ï¼Œå› æ­¤éœ€è¦å®¹å™¨èƒ½å¤Ÿéšæ—¶éšåœ°è·Ÿ`å¾®åº”ç”¨æ¶æ„`è¿›è¡Œé›†æˆï¼š

  ![](https://user-images.githubusercontent.com/773248/53077083-337a5880-352c-11e9-9969-b50c529fb3e8.png)

* å‘æˆç†Ÿçš„`å®¹å™¨`æ¶æ„å€Ÿé‰´ï¼Œæ¯”å¦‚ `Android` å®Œå–„çš„ `Activity` ç”Ÿå‘½å‘¨æœŸç®¡ç†

# Feature

* âš™ï¸ è‡ªç”±è®¾ç½®é¡µé¢ä¿æ´»ï¼ˆkeep aliveï¼‰æ•°é‡
* ğŸš€ `llpage` åœ¨æ“ä½œé¡µé¢æ¨¡å‹æ—¶å†…éƒ¨é‡‡ç”¨ä¸¤ä¸ªåŒå‘é“¾è¡¨æ¥ä¿è¯åŸå­æ“ä½œçš„é«˜æ€§èƒ½
* ğŸ’— å†…ç½®å¸¸è§çš„é¡µé¢æ“ä½œ `open`/`close`/`closeAll`/`refresh`/`closeOthers`
* ğŸ‘€ å•å‘æ•°æ®æµï¼Œæ¨¡å‹çŠ¶æ€æœºå†…éƒ¨æ‰§è¡Œï¼Œé¡µé¢æ“ä½œæ¨¡å‹å¯ä»¥è¢« dump
* ğŸ“± å®Œå–„çš„ç±» `Android` çš„ç”Ÿå‘½å‘¨æœŸæ¨¡æ‹Ÿ
* ğŸ’» çº¯å†…å­˜æ“ä½œæ¨¡å‹ï¼Œæå‡å¾®åº”ç”¨æ¡†æ¶é›†æˆçš„ä¾¿æ·ç¨‹åº¦
* ğŸ‰ æ”¯æŒå¼‚æ­¥ç”Ÿå‘½å‘¨æœŸ hook

# Quick Start

```javascript
import { createLLPageManager, createPage } from 'llpage'

const testPage = createPage({
  data: {},

  // llpage æ”¯æŒå¼‚æ­¥ç”Ÿå‘½å‘¨æœŸ hook
  async onCreate() {
    // do something
    await xx()
  }

  async onStart() {
    // do something
  }
})

const ll = createLLPageManager({
  size: 10
})

// open page
ll.open(testPage)

// close page
ll.close(testPage)

// close others
ll.closeOthers(testPage)

// close all
ll.closeAll()
```

# API

## top api

### createLLPageManager

> åˆ›å»ºä¸€ä¸ª llpage ç®¡ç†å®¹å™¨

### createPage

> åˆ›å»ºä¸€ä¸ªé¡µé¢å¯¹è±¡

## manager instance api

### open

> æ‰“å¼€ä¸€ä¸ªé¡µé¢

### close

> å…³é—­æŸä¸ªé¡µé¢

### closeAll

> å…³é—­æ‰€æœ‰é¡µé¢

### closeOthers

> å…³é—­å…¶ä»–é¡µé¢

### refresh

> åˆ·æ–°é¡µé¢

## page lifecycle

### onCreate

> åœ¨é¡µé¢å¯¹è±¡è¢«æ¿€æ´»æ—¶æ‰§è¡Œ

### onStart

> åœ¨é¡µé¢å¯¹è±¡è¢«æ¿€æ´»åï¼Œå³å°†å¼€å§‹ running æ—¶æ‰§è¡Œ

### onResume

> åœ¨é¡µé¢å¯¹è±¡è¢«éšè—åé‡æ–°æ¿€æ´»æ—¶æ‰§è¡Œ

### onPause

> åœ¨é¡µé¢å¯¹è±¡è¢«éšè—æ—¶æ‰§è¡Œ

### onStop

> åœ¨é¡µé¢å¯¹è±¡è¢«é”€æ¯å‰æ‰§è¡Œ

### onDestroy

> åœ¨é¡µé¢å¯¹è±¡è¢«é”€æ¯æ—¶æ‰§è¡Œ

### onRestart

> å½“é¡µé¢å¯¹è±¡æ›¾ç»è¢«æ‰“å¼€è¿‡ï¼Œå¹¶ä¸”å½“å‰å¤„äº dead çŠ¶æ€ä¸­ï¼Œè¿™ä¸ªæ—¶å€™è¢«é‡æ–°æ¿€æ´»æ—¶æ‰§è¡Œ

### onRefresh

> å½“é¡µé¢å¤„äºéæ·˜æ±°çŠ¶æ€ï¼Œè¢«åˆ·æ–°æ—¶è§¦å‘ï¼Œæ¥æ”¶ä¸€ä¸ª`æ˜¯å¦ä¸ºå½“å‰è¿è¡Œé¡µé¢`çš„å‚æ•° `isRunning`

# Async

> llpage æ”¯æŒåœ¨ç”Ÿå‘½å‘¨æœŸå†…æ‰§è¡Œå¼‚æ­¥æ“ä½œï¼Œllpage å†…éƒ¨ä¼šè‡ªåŠ¨å¤„ç†å¥½è¿™äº› hook çš„æ‰§è¡Œé¡ºåºï¼Œå› æ­¤ä½ å¯ä»¥è‡ªç”±åœ°ä½¿ç”¨ `async`

# Run Example

![preview](https://user-images.githubusercontent.com/773248/52936756-1f055700-3398-11e9-843a-1899dba7c36a.gif)

* [How to run](./examples/README.md)

# Thanks

* [lru_map](https://www.npmjs.com/package/lru_map)
* [@humanwhocodes/circular-doubly-linked-list](https://www.npmjs.com/package/@humanwhocodes/circular-doubly-linked-list)
