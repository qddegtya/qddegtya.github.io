---
layout: single
title: å·¥ä½œæµé¢„è§ˆç‰ˆä»‹ç»ï¼šä¸€ç§æ–°çš„ä½¿ç”¨ LlamaIndex åˆ›å»ºå¤æ‚ AI åº”ç”¨çš„æ–¹å¼ï¼ˆè¯‘ï¼‰
tags: llm è¯‘æ–‡
category: llm
excerpt: "æˆ‘ä»¬å¾ˆé«˜å…´åœ°ä»‹ç» LlamaIndex çš„ä¸€ä¸ªå…¨æ–°æµ‹è¯•åŠŸèƒ½ï¼šå·¥ä½œæµï¼Œè¿™æ˜¯ä¸€ç§ç”¨äºåè°ƒæ—¥ç›Šå¤æ‚çš„ AI åº”ç”¨ä¸­æ“ä½œçš„æœºåˆ¶ï¼Œæˆ‘ä»¬å‘ç°ç”¨æˆ·æ­£åœ¨æ„å»ºè¿™æ ·çš„åº”ç”¨ã€‚"
---

æˆ‘ä»¬å¾ˆé«˜å…´åœ°ä»‹ç» LlamaIndex çš„ä¸€ä¸ªå…¨æ–°æµ‹è¯•åŠŸèƒ½ï¼šå·¥ä½œæµï¼Œè¿™æ˜¯ä¸€ç§ç”¨äºåè°ƒæ—¥ç›Šå¤æ‚çš„ AI åº”ç”¨ä¸­æ“ä½œçš„æœºåˆ¶ï¼Œæˆ‘ä»¬å‘ç°ç”¨æˆ·æ­£åœ¨æ„å»ºè¿™æ ·çš„åº”ç”¨ã€‚

éšç€å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMsï¼‰çš„å‡ºç°ï¼Œä¸€ç§è¶‹åŠ¿å¼€å§‹å½¢æˆï¼Œç°åœ¨å·²ç»æˆä¸ºäº‹å®ä¸Šçš„æ ‡å‡†ï¼šäººå·¥æ™ºèƒ½åº”ç”¨ç”±ä¸åŒç»„ä»¶å®ç°çš„å¤šä¸ªä»»åŠ¡ç»„æˆã€‚å¸‚åœºä¸Šçš„å¼€æºæ¡†æ¶åŠªåŠ›é€šè¿‡æä¾›æ˜“äºä½¿ç”¨çš„æŠ½è±¡æ¥ç®€åŒ–äººå·¥æ™ºèƒ½å·¥ç¨‹å¸ˆçš„ç”Ÿæ´»ï¼Œè¿™äº›æŠ½è±¡æ¶µç›–äº†ä»æ•°æ®åŠ è½½å™¨ã€LLMsã€å‘é‡æ•°æ®åº“ã€é‡æ’åºå™¨åˆ°å¤–éƒ¨æœåŠ¡ç­‰åŸºç¡€ç»„ä»¶ã€‚ä¸æ­¤åŒæ—¶ï¼Œæ‰€æœ‰è¿™äº›æ¡†æ¶ä¹Ÿåœ¨å¯»æ±‚æœ€ä½³çš„æŠ½è±¡æ¥åè°ƒè¿™äº›ç»„ä»¶ï¼Œç ”ç©¶å¯¹äºäººå·¥æ™ºèƒ½å¼€å‘è€…æ¥è¯´æœ€ç›´è§‚å’Œé«˜æ•ˆçš„å®ç°æ–¹å¼ï¼Œä»¥ä¾¿å®ç°å°†å¤åˆäººå·¥æ™ºèƒ½ç³»ç»Ÿç´§å¯†è”ç³»åœ¨ä¸€èµ·çš„é€»è¾‘ã€‚

è¿™ä¸¤ç§æ½œåœ¨çš„ç¼–æ’æ¨¡å¼æ˜¯é“¾å’Œç®¡é“ï¼Œå®ƒä»¬éƒ½æ˜¯ç›¸åŒçš„æœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰æŠ½è±¡çš„å®ç°ã€‚æˆ‘ä»¬åœ¨è¿™æ–¹é¢è¿›è¡Œäº†å°è¯•[æŸ¥è¯¢ç®¡é“](https://www.llamaindex.ai/blog/introducing-query-pipelines-025dc2bb0537)åœ¨å¹´åˆå‘å¸ƒâ€”â€”å®ƒæ˜¯ä¸€ä¸ªå£°æ˜å¼APIï¼Œè®©ä½ å¯ä»¥é’ˆå¯¹ä¸åŒçš„ç”¨ä¾‹ï¼ˆå¦‚QAã€ç»“æ„åŒ–æå–å’Œä»£ç†è‡ªåŠ¨åŒ–ï¼‰å¯¹ä½ çš„æ•°æ®æ‰§è¡Œç®€å•åˆ°é«˜çº§çš„æŸ¥è¯¢å·¥ä½œæµã€‚ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬å°è¯•åœ¨å…¶åŸºç¡€ä¸Šæ„å»ºå¹¶å°è¯•æ·»åŠ å¾ªç¯ä»¥æ›´å¥½åœ°æ”¯æŒæ›´å¤æ‚çš„å·¥ä½œæµæ—¶ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°äº†å‡ ä¸ªé—®é¢˜ï¼Œè¿™è®©æˆ‘ä»¬åæ€ä¸ºä»€ä¹ˆDAGå¯èƒ½ä¸é€‚åˆä»£ç†æ™¯è§‚ï¼Œä»¥åŠæˆ‘ä»¬å¯ä»¥åœ¨æ¡†æ¶ä¸­å¼•å…¥ä»€ä¹ˆæ›¿ä»£æ–¹æ¡ˆã€‚

åŸºäºå›¾çš„ç”¨æˆ·ä½“éªŒçš„å±€é™æ€§
------------

DAGï¼ˆæœ‰å‘æ— ç¯å›¾ï¼‰çš„ä¸€ä¸ªåŸºæœ¬ç‰¹æ€§å°±æ˜¯å®ƒçš„â€œAâ€ï¼šå®ƒä»¬æ˜¯æ— ç¯çš„ï¼Œæ„å‘³ç€æ²¡æœ‰å¾ªç¯ã€‚ä½†åœ¨ä¸€ä¸ªè¶Šæ¥è¶Šå…·æœ‰ä»£ç†æ€§çš„ä¸–ç•Œé‡Œï¼ŒAIåº”ç”¨é€»è¾‘ä¸­æ— æ³•æ‰§è¡Œå¾ªç¯çš„èƒ½åŠ›æ˜¯ä¸å¯æ¥å—çš„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªç»„ä»¶æä¾›äº†ç³Ÿç³•çš„ç»“æœï¼ŒAIå¼€å‘è€…åº”è¯¥æœ‰ä¸€ç§æ–¹æ³•å‘Šè¯‰ç³»ç»Ÿè‡ªæˆ‘ä¿®æ­£å¹¶é‡è¯•ã€‚

å³ä½¿åœ¨DAGä¸­æ²¡æœ‰æ·»åŠ å¾ªç¯å’Œå›ç¯ï¼ŒæŸ¥è¯¢ç®¡é“ä¹Ÿå­˜åœ¨ä¸€äº›æ˜æ˜¾çš„é—®é¢˜ï¼š

*   å½“äº‹æƒ…å‡ºé”™æ—¶ï¼Œå¾ˆéš¾è°ƒè¯•
*   å®ƒä»¬éšè—äº†ç»„ä»¶å’Œæ¨¡å—æ˜¯å¦‚ä½•è¢«æ‰§è¡Œçš„
*   æˆ‘ä»¬çš„ç®¡é“ç¼–æ’å™¨å˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œå¹¶ä¸”å¿…é¡»å¤„ç†å¤§é‡çš„ä¸åŒè¾¹ç¼˜æƒ…å†µã€‚
*   å¯¹äºå¤æ‚çš„ç®¡é“ï¼Œå®ƒä»¬å¾ˆéš¾é˜…è¯»

ä¸€æ—¦æˆ‘ä»¬ä¸ºæŸ¥è¯¢ç®¡é“æ·»åŠ äº†å¾ªç¯ï¼Œè¿™äº›å…³äºå›¾çš„å¼€å‘è€…ç”¨æˆ·ä½“éªŒé—®é¢˜å°±è¢«æ”¾å¤§äº†ã€‚æˆ‘ä»¬åœ¨è¯¸å¦‚ä»¥ä¸‹é¢†åŸŸäº²èº«ä½“éªŒäº†å¼€å‘è€…çš„ç—›è‹¦ï¼š

*   è®¸å¤šæ ¸å¿ƒçš„ç¼–æ’é€»è¾‘ï¼Œå¦‚`if-else`å£°æ˜å’Œ`while`å¾ªç¯è¢«çƒ˜ç„™åˆ°å›¾çš„è¾¹ç¼˜ã€‚å®šä¹‰è¿™äº›è¾¹ç¼˜å˜å¾—ç¹çå’Œå†—é•¿ã€‚
*   å¤„ç†å¯é€‰å€¼å’Œé»˜è®¤å€¼çš„è¾¹ç¼˜æƒ…å†µå˜å¾—å›°éš¾ã€‚å¯¹äºæˆ‘ä»¬ä½œä¸ºä¸€ä¸ªæ¡†æ¶æ¥è¯´ï¼Œå¾ˆéš¾å¼„æ¸…æ¥šä¸€ä¸ªå‚æ•°æ˜¯å¦ä¼šä»ä¸Šæ¸¸èŠ‚ç‚¹ä¼ é€’è¿‡æ¥ã€‚
*   å®šä¹‰å…·æœ‰å¾ªç¯çš„å›¾å¯¹äºæ„å»ºä»£ç†çš„å¼€å‘è€…æ¥è¯´å¹¶ä¸æ€»æ˜¯æ„Ÿè§‰é‚£ä¹ˆè‡ªç„¶ã€‚ä»£ç†å°è£…äº†ä¸€ä¸ªé€šç”¨çš„LLMé©±åŠ¨å®ä½“ï¼Œå®ƒå¯ä»¥æ¥æ”¶è§‚å¯Ÿå¹¶ç”Ÿæˆå“åº”ã€‚åœ¨è¿™é‡Œï¼Œå›¾UXå¼ºåˆ¶â€œä»£ç†â€èŠ‚ç‚¹æ˜ç¡®å®šä¹‰äº†ä¼ å…¥è¾¹å’Œä¼ å‡ºè¾¹ï¼Œè¿«ä½¿ç”¨æˆ·ä¸å…¶ä»–èŠ‚ç‚¹å®šä¹‰å†—é•¿çš„é€šä¿¡æ¨¡å¼ã€‚

æˆ‘ä»¬é—®ï¼šå›¾çœŸçš„æ˜¯æˆ‘ä»¬å”¯ä¸€å¯ä»¥ç”¨æ¥åè°ƒå¤åˆäººå·¥æ™ºèƒ½ç³»ç»Ÿä¸­ç»„ä»¶çš„æŠ½è±¡å—ï¼Ÿ

ä»å›¾è¡¨åˆ°EDAï¼šè½¬å‘äº‹ä»¶é©±åŠ¨
--------------

å¤åˆäººå·¥æ™ºèƒ½ç³»ç»Ÿå¯ä»¥é€šè¿‡LlamaIndexå®ç°_å·¥ä½œæµ_ã€‚å·¥ä½œæµé€šè¿‡ä¸€ç³»åˆ—ç§°ä¸ºPythonå‡½æ•°çš„é›†åˆæ¥å›åˆ†æ´¾äº‹ä»¶_æ­¥éª¤_æ¯ä¸ªæ­¥éª¤éƒ½å¯ä»¥çœ‹ä½œæ˜¯ç³»ç»Ÿçš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†ï¼šä¸€ä¸ªç”¨äºå¤„ç†æŸ¥è¯¢ï¼Œä¸€ä¸ªç”¨äºä¸LLMå¯¹è¯ï¼Œä¸€ä¸ªç”¨äºä»å‘é‡æ•°æ®åº“åŠ è½½æ•°æ®ï¼Œç­‰ç­‰ã€‚æ¯ä¸ªæ­¥éª¤æ¥æ”¶ä¸€ä¸ªæˆ–å¤šä¸ªäº‹ä»¶è¿›è¡Œå¤„ç†ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©æ€§åœ°å‘é€å›äº‹ä»¶ï¼Œè¿™äº›äº‹ä»¶å°†è¢«è½¬å‘åˆ°å…¶ä»–ç»„ä»¶ã€‚

è½¬å‘äº‹ä»¶é©±åŠ¨æ¶æ„ä¼šå¯¼è‡´è®¾è®¡ä¸Šçš„æ ¹æœ¬è½¬å˜ã€‚åœ¨è®¸å¤šå›¾å½¢å®ç°ä¸­ï¼Œå›¾å½¢éå†ç®—æ³•è´Ÿè´£ç¡®å®šä¸‹ä¸€ä¸ªåº”è¯¥è¿è¡Œå“ªä¸ªç»„ä»¶ä»¥åŠåº”è¯¥ä¼ é€’å“ªäº›æ•°æ®ã€‚åœ¨äº‹ä»¶é©±åŠ¨æ¶æ„ä¸­ï¼Œç»„ä»¶è®¢é˜…äº†æŸäº›ç±»å‹çš„äº‹ä»¶ï¼Œå¹¶ä¸”å®ƒæœ€ç»ˆè´Ÿè´£æ ¹æ®æ¥æ”¶åˆ°çš„æ•°æ®å†³å®šè¦åšä»€ä¹ˆã€‚

åœ¨äº‹ä»¶é©±åŠ¨ç³»ç»Ÿä¸­ï¼Œåƒè¾“å…¥çš„å¯é€‰æ€§å’Œé»˜è®¤å€¼è¿™æ ·çš„æ¦‚å¿µåœ¨ç»„ä»¶çº§åˆ«ä¸Šå¾—åˆ°äº†è§£å†³ï¼Œå¤§å¤§ç®€åŒ–äº†ç¼–æ’ä»£ç ã€‚

å·¥ä½œæµç¨‹å…¥é—¨
------

ä¸ºäº†å¸®åŠ©æ¾„æ¸…è¿™ä¸ªæƒ³æ³•ï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ã€‚ä¸€ä¸ªæœ€å°çš„LlamaIndexå·¥ä½œæµç¨‹çœ‹èµ·æ¥åƒè¿™æ ·ï¼š

```python
    from llama_index.core.workflow import (
        StartEvent,
        StopEvent,
        Workflow,
        step,
    )

    from llama_index.llms.openai import OpenAI

    class OpenAIGenerator(Workflow):
        @step()
        async def generate(self, ev: StartEvent) -> StopEvent:
            query = ev.get("query")
            llm = OpenAI()
            response = await llm.acomplete(query)
            return StopEvent(result=str(response))

    w = OpenAIGenerator(timeout=10, verbose=False)
    result = await w.run(query="What's LlamaIndex?")
    print(result)
```

è¿™ä¸ª`generate`å‡½æ•°è¢«æ ‡è®°ä¸ºä½¿ç”¨å·¥ä½œæµæ­¥éª¤`@step`è£…é¥°å™¨ï¼Œå¹¶å£°æ˜å®ƒæƒ³è¦æ¥æ”¶å“ªäº›äº‹ä»¶ï¼Œä»¥åŠå®ƒå°†ä½¿ç”¨é€‚å½“çš„ç±»å‹æ³¨é‡Šé€šè¿‡æ–¹æ³•ç­¾åå‘é€å›å“ªäº›äº‹ä»¶ã€‚ä¸ºäº†è¿è¡Œå·¥ä½œæµï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª`OpenAIGenerator`ç±»ä¼ é€’ä¸€äº›é…ç½®å‚æ•°ï¼Œå¦‚æ‰€éœ€çš„è¶…æ—¶æ—¶é—´ï¼Œç„¶åæˆ‘ä»¬è°ƒç”¨`run`æ–¹æ³•ã€‚ä¼ é€’ç»™ä»»ä½•å…³é”®å­—å‚æ•°`run`å°†è¢«æ‰“åŒ…è¿›ä¸€ä¸ªç‰¹æ®Šäº‹ä»¶ç±»å‹`StartEvent`è¿™å°†è¢«è½¬å‘åˆ°è¯·æ±‚å®ƒçš„æ­¥éª¤ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªæœ‰`generate`æ­¥éª¤ï¼‰ã€‚`generate`æ­¥éª¤è¿”å›ä¸€ä¸ªç‰¹æ®Šäº‹ä»¶ç±»å‹`StopEvent`è¿™å°†æŒ‡ç¤ºå·¥ä½œæµä¼˜é›…åœ°åœæ­¢æ‰§è¡Œã€‚ä¸€ä¸ª`StopEvent`æºå¸¦ä»»ä½•æˆ‘ä»¬æƒ³è¦ä½œä¸ºå·¥ä½œæµç»“æœè¿”å›ç»™è°ƒç”¨è€…çš„æ•°æ®ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯LLMå“åº”ã€‚

### å·¥ä½œæµå¯ä»¥å¾ªç¯

åœ¨äº‹ä»¶é©±åŠ¨æ¶æ„ä¸­ï¼Œå¾ªç¯ä¸é€šä¿¡æœ‰å…³ï¼Œè€Œä¸æ˜¯æ‹“æ‰‘ã€‚ä»»ä½•æ­¥éª¤éƒ½å¯ä»¥é€šè¿‡åˆ¶ä½œå’Œå‘é€é€‚å½“çš„äº‹ä»¶æ¥å†³å®šå¤šæ¬¡è°ƒç”¨å¦ä¸€ä¸ªæ­¥éª¤ã€‚è®©æˆ‘ä»¬ä»¥ä¸€ä¸ªè‡ªæˆ‘æ ¡æ­£å¾ªç¯ä¸ºä¾‹ï¼ˆæ£€æŸ¥[ç¬”è®°æœ¬](https://docs.llamaindex.ai/en/latest/examples/workflow/reflection/)ï¼ˆå®Œæ•´çš„ä»£ç ï¼‰ï¼š

```python
    class ExtractionDone(Event):
        output: str
        passage: str


    class ValidationErrorEvent(Event):
        error: str
        wrong_output: str
        passage: str


    class ReflectionWorkflow(Workflow):
        @step()
        async def extract(
            self, ev: StartEvent | ValidationErrorEvent
        ) -> StopEvent | ExtractionDone:
            if isinstance(ev, StartEvent):
                passage = ev.get("passage")
                if not passage:
                    return StopEvent(result="Please provide some text in input")
                reflection_prompt = ""
            elif isinstance(ev, ValidationErrorEvent):
                passage = ev.passage
                reflection_prompt = REFLECTION_PROMPT.format(
                    wrong_answer=ev.wrong_output, error=ev.error
                )

            llm = Ollama(model="llama3", request_timeout=30)
            prompt = EXTRACTION_PROMPT.format(
                passage=passage, schema=CarCollection.schema_json()
            )
            if reflection_prompt:
                prompt += reflection_prompt

            output = await llm.acomplete(prompt)

            return ExtractionDone(output=str(output), passage=passage)

        @step()
        async def validate(
            self, ev: ExtractionDone
        ) -> StopEvent | ValidationErrorEvent:
            try:
                json.loads(ev.output)
            except Exception as e:
                print("Validation failed, retrying...")
                return ValidationErrorEvent(
                    error=str(e), wrong_output=ev.output, passage=ev.passage
                )

            return StopEvent(result=ev.output)

    w = ReflectionWorkflow(timeout=60, verbose=True)
    result = await w.run(
        passage="There are two cars available: a Fiat Panda with 45Hp and a Honda Civic with 330Hp."
    )
    print(result)
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`validate`æ­¥éª¤æ¥æ”¶è¯•æ¢æ€§æ¨¡å¼æå–çš„ç»“æœä½œä¸ºä¸€ä¸ªäº‹ä»¶ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡è¿”å›ä¸€ä¸ªæ¥å†³å®šå†æ¬¡å°è¯•`ValidationErrorEvent`è¿™æœ€ç»ˆå°†è¢«äº¤ä»˜ç»™`extract`æ­¥éª¤å°†æ‰§è¡Œå¦ä¸€æ¬¡å°è¯•ã€‚è¯·æ³¨æ„ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœè¿™ä¸ªæå–/éªŒè¯å¾ªç¯é•¿æ—¶é—´æä¾›ç³Ÿç³•çš„ç»“æœï¼Œå·¥ä½œæµå¯èƒ½ä¼šè¶…æ—¶ï¼Œä½†å¦ä¸€ç§ç­–ç•¥å¯èƒ½æ˜¯åœ¨ç²¾ç¡®å°è¯•æ¬¡æ•°åæ”¾å¼ƒï¼Œåªæ˜¯ä¸¾ä¸ªä¾‹å­ã€‚

### å·¥ä½œæµä¿æŒçŠ¶æ€

å·¥ä½œæµåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¿æŒä¸€ä¸ªå…¨å±€çŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€å¯ä»¥æ ¹æ®è¯·æ±‚è¢«å…±äº«å’Œä¼ æ’­åˆ°å…¶æ­¥éª¤ã€‚è¿™ç§å…±äº«çŠ¶æ€æ˜¯å®ç°ä¸ºä¸€ä¸ª`Context`å¯¹è±¡ï¼Œå¯ä»¥è¢«æ­¥éª¤ç”¨æ¥åœ¨è¿­ä»£ä¹‹é—´å­˜å‚¨æ•°æ®ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºä¸åŒæ­¥éª¤ä¹‹é—´äº¤æµçš„å¦ä¸€ç§å½¢å¼ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªæ›´å¤æ‚çš„ RAG ç¤ºä¾‹çš„æ‘˜å½•ï¼Œä½œä¸ºå±•ç¤ºå¦‚ä½•ä½¿ç”¨å…¨å±€ä¸Šä¸‹æ–‡çš„ä¾‹å­ï¼ˆè¯·æ£€æŸ¥[ç¬”è®°æœ¬](https://docs.llamaindex.ai/en/latest/examples/workflow/rag/)ï¼ˆå®Œæ•´ä»£ç ï¼‰ï¼š

```python
    class RAGWorkflow(Workflow):
        @step(pass_context=True)
        async def ingest(self, ctx: Context, ev: StartEvent) -> Optional[StopEvent]:
            dataset_name = ev.get("dataset")
            _, documents = download_llama_dataset(dsname, "./data")
            ctx.data["INDEX"] = VectorStoreIndex.from_documents(documents=documents)
            return StopEvent(result=f"Indexed {len(documents)} documents.")

        ...
```

åœ¨è¿™ç§æƒ…å†µä¸‹`ingest`æ­¥éª¤åˆ›å»ºäº†ä¸€ä¸ªç´¢å¼•ï¼Œå¹¶å¸Œæœ›åœ¨å·¥ä½œæµæ‰§è¡ŒæœŸé—´å°†å…¶æä¾›ç»™å¯èƒ½éœ€è¦å®ƒçš„ä»»ä½•å…¶ä»–æ­¥éª¤ã€‚åœ¨LlamaIndexå·¥ä½œæµä¸­ï¼Œå…¸å‹çš„åšæ³•æ˜¯å£°æ˜è¯¥æ­¥éª¤éœ€è¦ä¸€ä¸ªå…¨å±€ä¸Šä¸‹æ–‡çš„å®ä¾‹ã€‚`@step(pass_context=True)`ï¼ˆè¿™æ ·åšï¼‰å¹¶ä½¿ç”¨é¢„å®šä¹‰çš„é”®å°†ç´¢å¼•å­˜å‚¨åœ¨ä¸Šä¸‹æ–‡æœ¬èº«ä¸­ï¼Œå…¶ä»–æ­¥éª¤ç¨åå¯èƒ½ä¼šè®¿é—®è¿™ä¸ªé”®ã€‚

### å·¥ä½œæµç¨‹å¯ä»¥å®šåˆ¶

é™¤äº†å·¥ä½œæµï¼Œæˆ‘ä»¬è¿˜å°†å‘å¸ƒä¸€ç»„é¢„å®šä¹‰çš„å·¥ä½œæµï¼Œä»¥ä¾¿æœ€å¸¸ç”¨çš„ç”¨ä¾‹å¯ä»¥é€šè¿‡ä¸€è¡Œä»£ç å®ç°ã€‚ä½¿ç”¨è¿™äº›é¢„å®šä¹‰çš„æµç¨‹ï¼Œç”¨æˆ·ä»ç„¶å¯èƒ½æƒ³è¦_è½»å¾®åœ°_æ›´æ”¹é¢„å®šä¹‰çš„å·¥ä½œæµç¨‹ä»¥å¼•å…¥ä¸€äº›è‡ªå®šä¹‰è¡Œä¸ºï¼Œè€Œä¸å¿…ä»å¤´å¼€å§‹é‡å†™æ•´ä¸ªå·¥ä½œæµç¨‹ã€‚å‡è®¾æ‚¨æƒ³è¦è‡ªå®šä¹‰ä¸€ä¸ªRAGå·¥ä½œæµç¨‹ï¼Œå¹¶ä½¿ç”¨è‡ªå®šä¹‰çš„é‡æ–°æ’åæ­¥éª¤ï¼Œæ‚¨æ‰€éœ€è¦åšçš„å°±æ˜¯å¯¹ä¸€ä¸ªå‡è®¾çš„å†…ç½®ç±»è¿›è¡Œå­ç±»åŒ–ã€‚ å°†é¢„å®šä¹‰çš„å·¥ä½œæµç¨‹æ›´æ”¹ä¸ºå¼•å…¥ä¸€äº›è‡ªå®šä¹‰è¡Œä¸ºï¼Œè€Œæ— éœ€ä»å¤´å¼€å§‹é‡å†™æ•´ä¸ªå·¥ä½œæµç¨‹ã€‚å‡è®¾æ‚¨æƒ³è¦è‡ªå®šä¹‰ä¸€ä¸ªRAGå·¥ä½œæµç¨‹ï¼Œå¹¶ä½¿ç”¨è‡ªå®šä¹‰çš„é‡æ–°æ’åæ­¥éª¤ï¼Œæ‚¨æ‰€éœ€è¦åšçš„å°±æ˜¯å¯¹ä¸€ä¸ªå‡è®¾çš„å†…ç½®ç±»è¿›è¡Œå­ç±»åŒ–ã€‚ æ›´æ”¹é¢„å®šä¹‰çš„å·¥ä½œæµç¨‹ï¼Œä»¥å¼•å…¥ä¸€äº›è‡ªå®šä¹‰è¡Œä¸ºï¼Œè€Œæ— éœ€ä»å¤´å¼€å§‹é‡å†™æ•´ä¸ªå·¥ä½œæµç¨‹ã€‚æ¯”å¦‚è¯´ï¼Œæ‚¨æƒ³è¦è‡ªå®šä¹‰ä¸€ä¸ªRAGå·¥ä½œæµç¨‹ï¼Œå¹¶ä½¿ç”¨è‡ªå®šä¹‰çš„é‡æ–°æ’åæ­¥éª¤ï¼Œæ‚¨æ‰€éœ€è¦åšçš„åªæ˜¯å¯¹ä¸€ä¸ªå‡è®¾çš„å†…ç½®ç±»è¿›è¡Œå­ç±»åŒ–ã€‚`RAGWorkflow` ç±»å¹¶è¦†ç›–`rerank`åƒè¿™æ ·ä¸€æ­¥ï¼š

```python
    class MyWorkflow(RAGWorkflow):
        @step(pass_context=True)
        def rerank(
            self, ctx: Context, ev: Union[RetrieverEvent, StartEvent]
        ) -> Optional[QueryResult]:
            # my custom reranking logic here


    w = MyWorkflow(timeout=60, verbose=True)
    result = await w.run(query="Who is Paul Graham?")
```

### å¯ä»¥è°ƒè¯•å·¥ä½œæµ

éšç€åº”ç”¨ç¨‹åºé€»è¾‘çš„å¤æ‚æ€§å¢åŠ ï¼Œæ‚¨çš„å·¥ä½œæµçš„å¤æ‚æ€§ä¹Ÿä¼šå¢åŠ ï¼Œæœ‰æ—¶ä»…é€šè¿‡æŸ¥çœ‹Pythonä»£ç å¾ˆéš¾ç†è§£äº‹ä»¶åœ¨æ‰§è¡ŒæœŸé—´çš„æµåŠ¨ã€‚ä¸ºäº†ä¾¿äºç†è§£å¤æ‚çš„å·¥ä½œæµå¹¶æ”¯æŒå·¥ä½œæµæ‰§è¡Œçš„è°ƒè¯•ï¼ŒLlamaIndexæä¾›äº†ä¸¤ä¸ªåŠŸèƒ½ï¼š

*   `draw_all_possible_flows`ç”Ÿæˆä¸€ä¸ªæ˜¾ç¤ºå·¥ä½œæµä¸­æ‰€æœ‰æ­¥éª¤ä»¥åŠäº‹ä»¶å¯èƒ½æµå‘çš„å›¾ç‰‡
*   `draw_most_recent_execution`äº§ç”Ÿäº†ä¸€ä¸ªç±»ä¼¼çš„å›¾ç‰‡ï¼Œåªæ˜¾ç¤ºåœ¨ä¸Šä¸€æ¬¡å·¥ä½œæµæ‰§è¡ŒæœŸé—´å®é™…å‘é€çš„äº‹ä»¶

![](https://www.llamaindex.ai/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F7m9jw85w%2Fproduction%2F4db2cf184b7318891c997552e832638838e67620-1164x758.png%3Ffit%3Dmax%26auto%3Dformat&w=1200&q=75)

é™¤æ­¤ä¹‹å¤–ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨æ‰§è¡Œå·¥ä½œæµ`run_step()`å¤šæ¬¡ï¼Œç›´åˆ°æ‰€æœ‰æ­¥éª¤éƒ½å®Œæˆã€‚åœ¨æ¯ä¸ª`run_step`è°ƒç”¨æ—¶ï¼Œå¯ä»¥æ£€æŸ¥å·¥ä½œæµï¼ŒæŸ¥çœ‹ä»»ä½•ä¸­é—´ç»“æœæˆ–è°ƒè¯•æ—¥å¿—ã€‚

ä¸ºä»€ä¹ˆä½ åº”è¯¥åœ¨ä»Šå¤©ä½¿ç”¨å·¥ä½œæµ
--------------

å°½ç®¡LlamaIndexå·¥ä½œæµè¿˜å¤„äºå¼€å‘çš„æ—©æœŸé˜¶æ®µï¼Œä½†ä¸æŸ¥è¯¢ç®¡é“ç›¸æ¯”ï¼Œå®ƒä»¬å·²ç»ä»£è¡¨äº†å‘å‰è¿ˆè¿›äº†ä¸€æ­¥ï¼Œæ‰©å±•äº†å®ƒä»¬çš„åŠŸèƒ½å¹¶å¢åŠ äº†æ›´å¤šçš„çµæ´»æ€§ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå·¥ä½œæµè¿˜é™„å¸¦äº†ä¸€ç³»åˆ—ä½ é€šå¸¸ä¼šä»ä¸€ä¸ªæˆç†Ÿå¾—å¤šçš„è½¯ä»¶ä¸­æœŸå¾…çš„ç‰¹æ€§ï¼š

*   å®Œå…¨å¼‚æ­¥æ”¯æŒæµå¼ä¼ è¾“
*   é»˜è®¤æƒ…å†µä¸‹æä¾›æ”¯æŒçš„é›†æˆï¼Œé€šè¿‡ä¸€é”®å¼å¯è§‚å¯Ÿæ€§
*   é€æ­¥æ‰§è¡Œï¼Œä¾¿äºè°ƒè¯•
*   éªŒè¯å’Œå¯è§†åŒ–äº‹ä»¶é©±åŠ¨çš„ä¾èµ–å…³ç³»
*   äº‹ä»¶è¢«å®ç°ä¸ºpydanticæ¨¡å‹ï¼Œä»¥ç®€åŒ–å®šåˆ¶å’Œæ–°ç‰¹æ€§çš„è¿›ä¸€æ­¥å¼€å‘

èµ„æº
--

çœ‹çœ‹æˆ‘ä»¬çš„[å·¥ä½œæµç¨‹æ–‡æ¡£](https://docs.llamaindex.ai/en/latest/module_guides/workflow/)æˆ‘ä»¬çš„[ä¾‹å­](https://github.com/run-llama/llama_index/tree/main/docs/docs/examples/workflow)åŒ…æ‹¬ï¼š

*   [RAG](https://docs.llamaindex.ai/en/latest/examples/workflow/rag/)
*   [åæ˜ ](https://docs.llamaindex.ai/en/latest/examples/workflow/reflection/)
*   [å‡½æ•°è°ƒç”¨](https://docs.llamaindex.ai/en/latest/examples/workflow/function_calling_agent/)
*   [ååº”ä»£ç†](https://docs.llamaindex.ai/en/latest/examples/workflow/react_agent/)

åŸæ–‡é“¾æ¥ï¼š[Introducing workflows beta: a new way to create complex AI applications with LlamaIndex](https://www.llamaindex.ai/blog/introducing-workflows-beta-a-new-way-to-create-complex-ai-applications-with-llamaindex)

æœ¬æ–‡ä½¿ç”¨ [ğŸ A `C(Collect) -> T(Transform) -> P(Publish)` automation workflow for content creator.](https://github.com/qddegtya/r) å…¨è‡ªåŠ¨é‡‡é›† - ç¿»è¯‘ - å‘å¸ƒ
