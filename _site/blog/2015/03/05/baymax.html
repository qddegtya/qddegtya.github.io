<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="format-detection" content="telephone=no, email=no" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" /><!-- 删除苹果默认的工具栏和菜单栏 -->
    <meta name="apple-mobile-web-app-status-bar-style" content="black" /><!-- 设置苹果工具栏颜色 -->
    <meta name="format-detection" content="telphone=no, email=no" /><!-- 忽略页面中的数字识别为电话，忽略email识别 -->
    <!-- 启用360浏览器的极速模式(webkit) -->
    <meta name="renderer" content="webkit">
    <!-- 避免IE使用兼容模式 -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- 针对手持设备优化，主要是针对一些老的不识别viewport的浏览器，比如黑莓 -->
    <meta name="HandheldFriendly" content="true">
    <!-- 微软的老式浏览器 -->
    <meta name="MobileOptimized" content="320">
    <!-- uc强制竖屏 -->
    <meta name="screen-orientation" content="portrait">
    <!-- QQ强制竖屏 -->
    <meta name="x5-orientation" content="portrait">
    <!-- UC强制全屏 -->
    <meta name="full-screen" content="yes">
    <!-- QQ强制全屏 -->
    <meta name="x5-fullscreen" content="true">
    <!-- UC应用模式 -->
    <meta name="browsermode" content="application">
    <!-- QQ应用模式 -->
    <meta name="x5-page-mode" content="app">
    <!-- windows phone 点击无高光 -->
    <meta name="msapplication-tap-highlight" content="no">
    <!-- 适应移动端end -->

    <!-- seo -->
    <meta name="description" content="Colorful，一个骚年路过这里，与你一起探讨关于前端技术，设计，Hack的奥秘。">
    <meta name="keyword" content="COLORFUL, Colorful, colorful, Archer, archer, 小A, 前端博客，前端工程师">
    <meta name="baidu-site-verification" content="FgaJaRYy0x" />

    <title>Colorful</title>
    <link rel="stylesheet" href="/assets/dist/theme.css?ver=2.0.6"/>
</head>
<body>

<!-- self ribbon -->
<a href="https://github.com/qddegtya/qddegtya.github.io"><img style="position: fixed; top: 0; left: 0; border: 0; z-index: 99999;" src="/assets/images/forkme_darkblue.png" alt="Fork me on GitHub"></a>

<header id="blog__header">
    <div class="blog__bighead">
        <div class="blog__head__img">
            <span class="logo--name bounceInDown">COLORFUL</span>
            <span class="logo--des">有个骚年路过这里</span>
        </div>
    </div>

    <!-- blog nav -->
    <div class="blog__nav">
        <ul class="blog__nav__ul">
            <li class="blog__nav__item current"><a href="/" class="navlink">HOME</a></li>
            <li class="blog__nav__item"><a href="/tags" class="navlink">TAGS</a></li>
            <li class="blog__nav__item"><a href="/archives" class="navlink">POSTS</a></li>
            <li class="blog__nav__item"><a href="/works" class="navlink">WORKS</a></li>
            <li class="blog__nav__item"><a href="/about" class="navlink">ABOUT</a></li>
        </ul>
    </div>
</header>

<section id="blogbody">
    <div class="clearleft bloglooparea">
        <div class="bloglists">
            <div class="blogbody__everyblog">
                <div class="blogbody__everyblog__header">
                    <a href="/blog/2015/03/05/baymax">SVG+JS实现新版手机QQ的手势消除红点消息的动画</a>
                </div>
                <div class="blogbody__everyblog__meta">
                    <span class="blogbody__everyblog__metainfo">2015 - 03 - 05</span>
                </div>
                <div class="blogbody__everyblog__tag">
                  
                    <span class="blogbody__tag__class"><a href="/tags/#svg">svg</a></span>
                  
                    <span class="blogbody__tag__class"><a href="/tags/#javascript">javascript</a></span>
                  
                </div>
                <div class="blogcontent blogbody__everyblog__excerpt" id="singleblogcontent">
                    <p>下面的配图仅供卖萌</p>

<p><img src="/assets/blog-images/2015-3-5/baymax.jpg" alt="" /></p>

<p>很久没有写博客了，今天给大家带来一个小折腾。
虽然说是小折腾，但还是废了不少劲，某位大神的博客写得好：
前端工程师要想脱颖而出，就要拿出草稿纸，所以有了如下这个丑陋无比的配图：</p>

<!-- more -->

<p><img src="https://github.com/qddegtya/cute-qq-redpoint/raw/master/paper.jpg" alt="Paper" title="草稿" /></p>

<p>此次折腾的相关信息如下：</p>

<h3 id="cute-qq-redpoint">cute-qq-redpoint</h3>

<p>SVG+JS实现新版手机QQ的手势消除红点消息的动画。
可以打开手机QQ，在底部菜单消息一栏的红点上进行拖拽体验。
本插件欲实现的就是这个效果。</p>

<h3 id="section">原理及部分代码</h3>

<p>做的比较粗糙，但是基本效果已经实现了。
通过计算草稿中四个坐标位置，然后在touchmove中更新path d即可，两条二次贝塞尔曲线是关键。
二次贝塞尔曲线的参考坐标可以轻松得出：
两个圆心相连线的中心即为该参考点。
故得到代码如下：</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">    <span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="s1">'use strict'</span><span class="p">;</span>

        <span class="kd">var</span> <span class="nx">initCircle</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'initCircle'</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">finalCircle</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'finalCircle'</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">aPath</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'animationPath'</span><span class="p">);</span>

        <span class="kd">var</span> <span class="nx">touchFingers</span><span class="p">;</span> <span class="c1">//缓存touches队列</span>

        <span class="c1">//初始圆坐标</span>
        <span class="kd">var</span> <span class="nx">x0</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">initCircle</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">'cx'</span><span class="p">));</span>
        <span class="kd">var</span> <span class="nx">y0</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">initCircle</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">'cy'</span><span class="p">));</span>
        <span class="kd">var</span> <span class="nx">r0</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">initCircle</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">'r'</span><span class="p">));</span>

        <span class="c1">//最终圆坐标</span>
        <span class="kd">var</span> <span class="nx">x1</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">y1</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">r1</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">finalCircle</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">'r'</span><span class="p">));</span>

        <span class="c1">//setter</span>
        <span class="nx">Element</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_setter</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">attr</span><span class="p">;</span>
            <span class="k">for</span><span class="p">(</span><span class="nx">attr</span> <span class="k">in</span> <span class="nx">options</span><span class="p">){</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">attr</span><span class="p">)){</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="nx">attr</span><span class="p">,</span> <span class="nx">options</span><span class="p">[</span><span class="nx">attr</span><span class="p">]);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">};</span>

        <span class="kd">var</span> <span class="nx">updateF</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">updateTouches</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">touchFingers</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">touches</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="p">};</span>


        <span class="kd">var</span> <span class="nx">renderThing</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

            <span class="nx">x1</span> <span class="o">=</span> <span class="nx">touchFingers</span><span class="p">.</span><span class="nx">clientX</span><span class="p">;</span>
            <span class="nx">y1</span> <span class="o">=</span> <span class="nx">touchFingers</span><span class="p">.</span><span class="nx">clientY</span><span class="p">;</span>

            <span class="c1">//二次贝赛尔曲线参考点</span>
            <span class="kd">var</span> <span class="nx">pX</span> <span class="o">=</span> <span class="nx">x0</span> <span class="o">-</span> <span class="p">((</span><span class="nx">x0</span> <span class="o">-</span> <span class="nx">x1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">pY</span> <span class="o">=</span> <span class="nx">y0</span> <span class="o">-</span> <span class="p">((</span><span class="nx">y0</span> <span class="o">-</span> <span class="nx">y1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>

            <span class="c1">//勾股x,y</span>
            <span class="kd">var</span> <span class="nx">_gX</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">x0</span> <span class="o">-</span> <span class="nx">x1</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">_gY</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">y0</span> <span class="o">-</span> <span class="nx">y1</span><span class="p">);</span>

            <span class="c1">//勾股定理斜线长度长</span>
            <span class="kd">var</span> <span class="nx">longL</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">_gX</span> <span class="o">*</span> <span class="nx">_gX</span> <span class="o">+</span> <span class="nx">_gY</span> <span class="o">*</span> <span class="nx">_gY</span><span class="p">);</span>

            <span class="kd">var</span> <span class="nx">sinX</span> <span class="o">=</span> <span class="nx">_gY</span> <span class="o">/</span> <span class="nx">longL</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">cosX</span> <span class="o">=</span> <span class="nx">_gX</span> <span class="o">/</span> <span class="nx">longL</span><span class="p">;</span>

            <span class="c1">//四个点的路径构建</span>
            <span class="kd">var</span> <span class="nx">fourPoints</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">'M'</span><span class="p">,</span>
                <span class="nx">x0</span> <span class="o">+</span> <span class="nx">r0</span> <span class="o">*</span> <span class="nx">sinX</span><span class="p">,</span>
                <span class="nx">y0</span> <span class="o">+</span> <span class="nx">r0</span> <span class="o">*</span> <span class="nx">cosX</span><span class="p">,</span>
                <span class="s1">'Q'</span><span class="p">,</span>
                <span class="nx">pX</span><span class="p">,</span>
                <span class="nx">pY</span><span class="p">,</span>
                <span class="nx">x1</span> <span class="o">+</span> <span class="nx">r1</span> <span class="o">*</span> <span class="nx">sinX</span><span class="p">,</span>
                <span class="nx">y1</span> <span class="o">+</span> <span class="nx">r1</span> <span class="o">*</span> <span class="nx">cosX</span><span class="p">,</span>
                <span class="s1">'L'</span><span class="p">,</span>
                <span class="nx">x1</span> <span class="o">-</span> <span class="nx">r1</span> <span class="o">*</span> <span class="nx">sinX</span><span class="p">,</span>
                <span class="nx">y1</span> <span class="o">-</span> <span class="nx">r1</span> <span class="o">*</span> <span class="nx">cosX</span><span class="p">,</span>
                <span class="s1">'Q'</span><span class="p">,</span>
                <span class="nx">pX</span><span class="p">,</span>
                <span class="nx">pY</span><span class="p">,</span>
                <span class="nx">x0</span> <span class="o">-</span> <span class="nx">r0</span> <span class="o">*</span> <span class="nx">sinX</span><span class="p">,</span>
                <span class="nx">y0</span> <span class="o">-</span> <span class="nx">r0</span> <span class="o">*</span> <span class="nx">cosX</span><span class="p">,</span>
                <span class="s1">'Z'</span>
            <span class="p">];</span>

            <span class="nx">finalCircle</span><span class="p">.</span><span class="nx">_setter</span><span class="p">({</span>
                <span class="na">cx</span><span class="p">:</span> <span class="nx">x1</span><span class="p">,</span>
                <span class="na">cy</span><span class="p">:</span> <span class="nx">y1</span>
            <span class="p">});</span>

            <span class="c1">//设置路径</span>
            <span class="nx">aPath</span><span class="p">.</span><span class="nx">_setter</span><span class="p">({</span>
                <span class="na">d</span><span class="p">:</span> <span class="nx">fourPoints</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">' '</span><span class="p">)</span>
            <span class="p">});</span>

        <span class="p">};</span>

        <span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'touchstart'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
            <span class="nx">touchFingers</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">touches</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="p">});</span>

        <span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'touchmove'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span> <span class="c1">//屏蔽掉默认的滚动行为</span>
            <span class="nx">updateF</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
            <span class="nx">renderThing</span><span class="p">();</span>
        <span class="p">});</span>


    <span class="p">}());</span></code></pre></figure>

<h3 id="section-1">演示</h3>

<p>用手机打开
<a href="http://codepen.io/qddegtya/details/EapGWK" title="Demo">codepen在线Demo</a></p>

<h3 id="todo">TODO</h3>

<ol>
  <li>实现弹性系数K，模拟拉断的情况，加入初始圆的半径缩小控制</li>
  <li>插件化处理</li>
</ol>

<h3 id="github">Github</h3>

<p><a href="https://github.com/qddegtya/cute-qq-redpoint" title="源码地址">源码地址</a></p>

                </div>
                <div class="blogbody__everyblog__footer">
                    <div class="footercopyright">
                        <span>转载请注明出处</span>
                        <span class="blogperlink">/blog/2015/03/05/baymax</span>
                    </div>
                </div>
            </div>

        <div id="comments" class="comments">
  <div id="disqus_thread"></div>
  <script>
  /**
  * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
  * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
  */
  /*
  var disqus_config = function () {
  this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
  this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
  };
  */
  (function() { // DON'T EDIT BELOW THIS LINE
  var d = document, s = d.createElement('script');

  s.src = '//colorful-archer.disqus.com/embed.js';

  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
  })();
  </script>
</div>

        </div>

        <div class="blogsidebar">
    <!-- 简介 -->
    <div class="blogsidebar_item author_item">
        <h3 class="sidebar_title">AUTHOR</h3>
        <p class="sidebar_detail clearfix">
            <img src="/assets/images/js-avatar.jpg" class="avatar_detail" alt=""/>
            此人患有重度强迫症，逼格崇拜症，红色性格狂躁症。
            想让他安静下来，给他读一篇技术文章就好。
        </p>
    </div>

    <!-- 足迹 -->
    <div class="blogsidebar_item author_item">
        <h3 class="sidebar_title">FOLLOW</h3>
        <div id="sidebar_follows" class="sidebar_follows">
          <ul>
            <li><a href="http://gold.xitu.io/#/user/564596b360b25b79f069ad76" title="稀土掘金"><img src="http://gold.xitu.io/favicon.ico" alt="" class="site--fav"/>稀土掘金</a></li>
            <li><a href="https://github.com/qddegtya" title="GITHUB"><img src="https://github.com/favicon.ico" alt="" class="site--fav"/>GITHUB</a></li>
            <li><a href="http://weibo.com/IMArcher" title="微博"><img src="http://weibo.com/favicon.ico" alt="" class="site--fav"/>微博</a></li>
            <li><a href="https://coding.net/u/archer" title="Coding"><img src="https://coding.net/favicon.ico" alt="" class="site--fav"/>Coding</a></li>
            <li><a href="http://my.oschina.net/Archerminia" title="开源中国"><img src="http://oschina.net/favicon.ico" alt="" class="site--fav"/>开源中国</a></li>
          </ul>
        </div>
    </div>

    <!-- 标签云 -->
    <div class="blogsidebar_item author_item">
        <h3 class="sidebar_title">TAGS</h3>
        <div id="side_tags">
          
            
            <span class="blogbody__tag__class"><a href="/tags/#python">python</a></span>
            
          
            
            <span class="blogbody__tag__class"><a href="/tags/#jython">jython</a></span>
            
          
            
            <span class="blogbody__tag__class"><a href="/tags/#fe">fe</a></span>
            
          
            
            <span class="blogbody__tag__class"><a href="/tags/#tool">tool</a></span>
            
          
            
            <span class="blogbody__tag__class"><a href="/tags/#weixin">weixin</a></span>
            
          
            
            <span class="blogbody__tag__class"><a href="/tags/#flask">flask</a></span>
            
          
            
            <span class="blogbody__tag__class"><a href="/tags/#svg">svg</a></span>
            
          
            
            <span class="blogbody__tag__class"><a href="/tags/#javascript">javascript</a></span>
            
          
            
            <span class="blogbody__tag__class"><a href="/tags/#react-native">react-native</a></span>
            
          
            
            <span class="blogbody__tag__class"><a href="/tags/#vue">vue</a></span>
            
          
            
            <span class="blogbody__tag__class"><a href="/tags/#koa">koa</a></span>
            
          
            
            <span class="blogbody__tag__class"><a href="/tags/#nodejs">nodejs</a></span>
            
          
        </div>
    </div>
</div>

    </div>
</section>


<footer id="blogfooter" class="blogfooter">
    <h3 class="footer-title">COLORFUL</h3>
    <span class="copyright">Powered By <a href="http://jekyllrb.com/" title="Jekyll">Jekyll</a> / Theme is <a href="http://xiaoa.name/" title="Colorful">Colorful</a></span>
</footer>

</body>
</html>

